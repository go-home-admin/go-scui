"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[5825],{84428:function(e,t,i){i.r(t),i.d(t,{default:function(){return $}});var a=i(58222);const s={class:"custom-tree-node"},l={class:"label"},o={class:"code"},d={class:"do"},c=(0,a.createTextVNode)("字典分类"),n={class:"left-panel"},r=(0,a.createTextVNode)("编辑"),h=(0,a.createTextVNode)("删除");function p(e,t,i,p,u,m){const f=(0,a.resolveComponent)("el-input"),g=(0,a.resolveComponent)("el-header"),C=(0,a.resolveComponent)("el-button"),w=(0,a.resolveComponent)("el-button-group"),$=(0,a.resolveComponent)("el-tree"),v=(0,a.resolveComponent)("el-main"),x=(0,a.resolveComponent)("el-footer"),b=(0,a.resolveComponent)("el-container"),y=(0,a.resolveComponent)("el-aside"),V=(0,a.resolveComponent)("el-table-column"),N=(0,a.resolveComponent)("el-icon-d-caret"),D=(0,a.resolveComponent)("el-tag"),k=(0,a.resolveComponent)("el-switch"),_=(0,a.resolveComponent)("el-popconfirm"),S=(0,a.resolveComponent)("scTable"),T=(0,a.resolveComponent)("dic-dialog"),A=(0,a.resolveComponent)("list-dialog"),I=(0,a.resolveDirective)("loading");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(y,{width:"300px"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(b,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(g,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(f,{placeholder:"输入关键字进行过滤",modelValue:u.dicFilterText,"onUpdate:modelValue":t[0]||(t[0]=e=>u.dicFilterText=e),clearable:""},null,8,["modelValue"])])),_:1}),(0,a.createVNode)(v,{class:"nopadding"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)($,{ref:"dic",class:"menu","node-key":"id",data:u.dicList,props:u.dicProps,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":m.dicFilterNode,onNodeClick:m.dicClick},{default:(0,a.withCtx)((({node:e,data:t})=>[(0,a.createElementVNode)("span",s,[(0,a.createElementVNode)("span",l,(0,a.toDisplayString)(e.label),1),(0,a.createElementVNode)("span",o,(0,a.toDisplayString)(t.code),1),(0,a.createElementVNode)("span",d,[(0,a.createVNode)(w,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(C,{icon:"el-icon-edit",size:"small",onClick:(0,a.withModifiers)((e=>m.dicEdit(t)),["stop"])},null,8,["onClick"]),(0,a.createVNode)(C,{icon:"el-icon-delete",size:"small",onClick:(0,a.withModifiers)((i=>m.dicDel(e,t)),["stop"])},null,8,["onClick"])])),_:2},1024)])])])),_:1},8,["data","props","filter-node-method","onNodeClick"])])),_:1}),(0,a.createVNode)(x,{style:{height:"51px"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(C,{type:"primary",size:"small",icon:"el-icon-plus",style:{width:"100%"},onClick:m.addDic},{default:(0,a.withCtx)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})),[[I,u.showDicloading]]),(0,a.createVNode)(b,{class:"is-vertical"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(g,null,{default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",n,[(0,a.createVNode)(C,{type:"primary",icon:"el-icon-plus",onClick:m.addInfo},null,8,["onClick"]),(0,a.createVNode)(C,{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==u.selection.length,onClick:m.batch_del},null,8,["disabled","onClick"])])])),_:1}),(0,a.createVNode)(v,{class:"nopadding"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(S,{ref:"table",apiObj:u.listApi,"row-key":"id",params:u.listApiParams,onSelectionChange:m.selectionChange,stripe:"",paginationLayout:"prev, pager, next"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(V,{type:"selection",width:"50"}),(0,a.createVNode)(V,{label:"",width:"60"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(D,{class:"move",style:{cursor:"move"}},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(N,{style:{width:"1em",height:"1em"}})])),_:1})])),_:1}),(0,a.createVNode)(V,{label:"名称",prop:"name",width:"150"}),(0,a.createVNode)(V,{label:"键值",prop:"key",width:"150"}),(0,a.createVNode)(V,{label:"是否有效",prop:"yx",width:"100"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(k,{modelValue:e.row.yx,"onUpdate:modelValue":t=>e.row.yx=t,onChange:t=>m.changeSwitch(t,e.row),loading:e.row.$switch_yx,"active-value":"1","inactive-value":"0"},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])])),_:1}),(0,a.createVNode)(V,{label:"操作",fixed:"right",align:"right",width:"120"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(w,null,{default:(0,a.withCtx)((()=>[(0,a.createVNode)(C,{text:"",type:"primary",size:"small",onClick:t=>m.table_edit(e.row,e.$index)},{default:(0,a.withCtx)((()=>[r])),_:2},1032,["onClick"]),(0,a.createVNode)(_,{title:"确定删除吗？",onConfirm:t=>m.table_del(e.row,e.$index)},{reference:(0,a.withCtx)((()=>[(0,a.createVNode)(C,{text:"",type:"primary",size:"small"},{default:(0,a.withCtx)((()=>[h])),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)])),_:1})])),_:1},8,["apiObj","params","onSelectionChange"])])),_:1})])),_:1})])),_:1}),u.dialog.dic?((0,a.openBlock)(),(0,a.createBlock)(T,{key:0,ref:"dicDialog",onSuccess:m.handleDicSuccess,onClosed:t[1]||(t[1]=e=>u.dialog.dic=!1)},null,8,["onSuccess"])):(0,a.createCommentVNode)("",!0),u.dialog.list?((0,a.openBlock)(),(0,a.createBlock)(A,{key:1,ref:"listDialog",onSuccess:m.handleListSuccess,onClosed:t[2]||(t[2]=e=>u.dialog.list=!1)},null,8,["onSuccess"])):(0,a.createCommentVNode)("",!0)],64)}var u=i(98211),m=i(62134),f=i(51474),g={name:"dic",components:{dicDialog:u["default"],listDialog:m["default"]},data(){return{dialog:{dic:!1,info:!1},showDicloading:!0,dicList:[],dicFilterText:"",dicProps:{label:"name"},listApi:null,listApiParams:{},selection:[]}},watch:{dicFilterText(e){this.$refs.dic.filter(e)}},mounted(){this.getDic(),this.rowDrop()},methods:{async getDic(){var e=await this.$API.system.dic.tree.get();this.showDicloading=!1,this.dicList=e.data;var t=this.dicList[0];t&&(this.$nextTick((()=>{this.$refs.dic.setCurrentKey(t.id)})),this.listApiParams={code:t.code},this.listApi=this.$API.system.dic.list)},dicFilterNode(e,t){if(!e)return!0;var i=t.name+t.code;return-1!==i.indexOf(e)},addDic(){this.dialog.dic=!0,this.$nextTick((()=>{this.$refs.dicDialog.open()}))},dicEdit(e){this.dialog.dic=!0,this.$nextTick((()=>{var t=this.$refs.dic.getNode(e.id),i=1==t.level?void 0:t.parent.data.id;e.parentId=i,this.$refs.dicDialog.open("edit").setData(e)}))},dicClick(e){this.$refs.table.reload({code:e.code})},dicDel(e,t){this.$confirm(`确定删除 ${t.name} 项吗？`,"提示",{type:"warning"}).then((()=>{this.showDicloading=!0;var e=this.$refs.dic.getCurrentKey();if(this.$refs.dic.remove(t.id),e==t.id){var i=this.dicList[0];i?(this.$refs.dic.setCurrentKey(i.id),this.$refs.table.upData({code:i.code})):(this.listApi=null,this.$refs.table.tableData=[])}this.showDicloading=!1,this.$message.success("操作成功")})).catch((()=>{}))},rowDrop(){const e=this,t=this.$refs.table.$el.querySelector(".el-table__body-wrapper tbody");f.ZP.create(t,{handle:".move",animation:300,ghostClass:"ghost",onEnd({newIndex:t,oldIndex:i}){const a=e.$refs.table.tableData,s=a.splice(i,1)[0];a.splice(t,0,s),e.$message.success("排序成功")}})},addInfo(){this.dialog.list=!0,this.$nextTick((()=>{var e=this.$refs.dic.getCurrentKey();const t={dic:e};this.$refs.listDialog.open().setData(t)}))},table_edit(e){this.dialog.list=!0,this.$nextTick((()=>{this.$refs.listDialog.open("edit").setData(e)}))},async table_del(e,t){var i={id:e.id},a=await this.$API.demo.post.post(i);200==a.code?(this.$refs.table.tableData.splice(t,1),this.$message.success("删除成功")):this.$alert(a.message,"提示",{type:"error"})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();this.selection.forEach((e=>{this.$refs.table.tableData.forEach(((t,i)=>{e.id===t.id&&this.$refs.table.tableData.splice(i,1)}))})),e.close(),this.$message.success("操作成功")})).catch((()=>{}))},saveList(){this.$refs.listDialog.submit((async e=>{this.isListSaveing=!0;var t=await this.$API.demo.post.post(e);this.isListSaveing=!1,200==t.code?(this.listDialogVisible=!1,this.$message.success("操作成功")):this.$alert(t.message,"提示",{type:"error"})}))},selectionChange(e){this.selection=e},changeSwitch(e,t){t.yx="1"==t.yx?"0":"1",t.$switch_yx=!0,setTimeout((()=>{delete t.$switch_yx,t.yx=e,this.$message.success(`操作成功id:${t.id} val:${e}`)}),500)},handleDicSuccess(e,t){if("add"==t)e.id=(new Date).getTime(),this.dicList.length>0?this.$refs.table.upData({code:e.code}):(this.listApiParams={code:e.code},this.listApi=this.$API.dic.info),this.$refs.dic.append(e,e.parentId[0]),this.$refs.dic.setCurrentKey(e.id);else if("edit"==t){var i=this.$refs.dic.getNode(e.id),a=1==i.level?void 0:i.parent.data.id;if(a!=e.parentId){var s=i.data;this.$refs.dic.remove(e.id),this.$refs.dic.append(s,e.parentId[0])}Object.assign(i.data,e)}},handleListSuccess(e,t){"add"==t?(e.id=(new Date).getTime(),this.$refs.table.tableData.push(e)):"edit"==t&&this.$refs.table.tableData.filter((t=>t.id===e.id)).forEach((t=>{Object.assign(t,e)}))}}},C=i(83744);const w=(0,C.Z)(g,[["render",p],["__scopeId","data-v-e208fe92"]]);var $=w}}]);